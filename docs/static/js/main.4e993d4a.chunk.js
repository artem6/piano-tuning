(this["webpackJsonppiano-tuning"]=this["webpackJsonppiano-tuning"]||[]).push([[0],{19:function(e,n,t){},20:function(e,n,t){},23:function(e,n,t){"use strict";t.r(n);var a=t(1),r=t.n(a),o=t(11),i=t.n(o),c=(t(19),t(3)),u=t(2),l=t(4),s=(t(20),t(0)),h=function(e){var n=Object(a.useRef)(),t=Object(a.useRef)(),r=e||{},o=r.width,i=r.height,c=r.domain;o||(o=1024),i||(i=300),c||(c={x1:0,y1:0,x2:o,y2:i});var u=function(e){if(!c||!o)throw new Error;return(e-c.x1)/(c.x2-c.x1)*o},l=function(e){if(!c||!i)throw new Error;return(e-c.y1)/(c.y2-c.y1)*i},s=function(){return!t.current&&n.current&&(t.current=n.current.getContext("2d")),t.current};return{canvasRef:n,width:o,height:i,getCanvasContext:s,setDomain:function(e){c=e},clear:function(){var e=s();e&&o&&i&&e.clearRect(0,0,o,i)},line:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"gray",t=s();t&&(t.strokeStyle=n,t.beginPath(),t.moveTo(u(e.x1),l(e.y1)),t.lineTo(u(e.x2),l(e.y2)),t.stroke())},rect:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"gray",t=s();t&&(t.fillStyle=n,t.fillRect(u(e.x1),l(e.y1),u(e.x2)-u(e.x1),l(e.y2)-l(e.y1)))},circle:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"gray",a=s();a&&(a.strokeStyle=t,a.beginPath(),a.arc(u(e.x),l(e.y),n,0,2*Math.PI),a.stroke())},text:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"gray",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"8px Arial",r=s();r&&(r.fillStyle=t,r.font=a,r.fillText(n,u(e.x),l(e.y)))}}},d=function(e){var n=e.width,t=e.height,a=e.canvasRef;return Object(s.jsx)("canvas",{ref:a,width:n,height:t,style:{border:"1px dashed gray"}})},f=[{pos:1,key:"A",octave:0,idx:0,sharp:!1,hz:27.5,name:"A0 Double Pedal A"},{pos:2,key:"A",octave:0,idx:0,sharp:!0,hz:29.1352,name:"A\u266f0/B\u266d0"},{pos:3,key:"B",octave:0,idx:1,sharp:!1,hz:30.8677,name:"B0"},{pos:4,key:"C",octave:1,idx:2,sharp:!1,hz:32.7032,name:"C1 Pedal C"},{pos:5,key:"C",octave:1,idx:2,sharp:!0,hz:34.6478,name:"C\u266f1/D\u266d1"},{pos:6,key:"D",octave:1,idx:3,sharp:!1,hz:36.7081,name:"D1"},{pos:7,key:"D",octave:1,idx:3,sharp:!0,hz:38.8909,name:"D\u266f1/E\u266d1"},{pos:8,key:"E",octave:1,idx:4,sharp:!1,hz:41.2034,name:"E1"},{pos:9,key:"F",octave:1,idx:5,sharp:!1,hz:43.6535,name:"F1"},{pos:10,key:"F",octave:1,idx:5,sharp:!0,hz:46.2493,name:"F\u266f1/G\u266d1"},{pos:11,key:"G",octave:1,idx:6,sharp:!1,hz:48.9994,name:"G1"},{pos:12,key:"G",octave:1,idx:6,sharp:!0,hz:51.9131,name:"G\u266f1/A\u266d1"},{pos:13,key:"A",octave:1,idx:7,sharp:!1,hz:55,name:"A1"},{pos:14,key:"A",octave:1,idx:7,sharp:!0,hz:58.2705,name:"A\u266f1/B\u266d1"},{pos:15,key:"B",octave:1,idx:8,sharp:!1,hz:61.7354,name:"B1"},{pos:16,key:"C",octave:2,idx:9,sharp:!1,hz:65.4064,name:"C2 Deep C"},{pos:17,key:"C",octave:2,idx:9,sharp:!0,hz:69.2957,name:"C\u266f2/D\u266d2"},{pos:18,key:"D",octave:2,idx:10,sharp:!1,hz:73.4162,name:"D2"},{pos:19,key:"D",octave:2,idx:10,sharp:!0,hz:77.7817,name:"D\u266f2/E\u266d2"},{pos:20,key:"E",octave:2,idx:11,sharp:!1,hz:82.4069,name:"E2"},{pos:21,key:"F",octave:2,idx:12,sharp:!1,hz:87.3071,name:"F2"},{pos:22,key:"F",octave:2,idx:12,sharp:!0,hz:92.4986,name:"F\u266f2/G\u266d2"},{pos:23,key:"G",octave:2,idx:13,sharp:!1,hz:97.9989,name:"G2"},{pos:24,key:"G",octave:2,idx:13,sharp:!0,hz:103.826,name:"G\u266f2/A\u266d2"},{pos:25,key:"A",octave:2,idx:14,sharp:!1,hz:110,name:"A2"},{pos:26,key:"A",octave:2,idx:14,sharp:!0,hz:116.541,name:"A\u266f2/B\u266d2"},{pos:27,key:"B",octave:2,idx:15,sharp:!1,hz:123.471,name:"B2"},{pos:28,key:"C",octave:3,idx:16,sharp:!1,hz:130.813,name:"C3"},{pos:29,key:"C",octave:3,idx:16,sharp:!0,hz:138.591,name:"C\u266f3/D\u266d3"},{pos:30,key:"D",octave:3,idx:17,sharp:!1,hz:146.832,name:"D3"},{pos:31,key:"D",octave:3,idx:17,sharp:!0,hz:155.563,name:"D\u266f3/E\u266d3"},{pos:32,key:"E",octave:3,idx:18,sharp:!1,hz:164.814,name:"E3"},{pos:33,key:"F",octave:3,idx:19,sharp:!1,hz:174.614,name:"F3"},{pos:34,key:"F",octave:3,idx:19,sharp:!0,hz:184.997,name:"F\u266f3/G\u266d3"},{pos:35,key:"G",octave:3,idx:20,sharp:!1,hz:195.998,name:"G3"},{pos:36,key:"G",octave:3,idx:20,sharp:!0,hz:207.652,name:"G\u266f3/A\u266d3"},{pos:37,key:"A",octave:3,idx:21,sharp:!1,hz:220,name:"A3"},{pos:38,key:"A",octave:3,idx:21,sharp:!0,hz:233.082,name:"A\u266f3/B\u266d3"},{pos:39,key:"B",octave:3,idx:22,sharp:!1,hz:246.942,name:"B3"},{pos:40,key:"C",octave:4,idx:23,sharp:!1,hz:261.626,name:"C4 Middle C"},{pos:41,key:"C",octave:4,idx:23,sharp:!0,hz:277.183,name:"C\u266f4/D\u266d4"},{pos:42,key:"D",octave:4,idx:24,sharp:!1,hz:293.665,name:"D4"},{pos:43,key:"D",octave:4,idx:24,sharp:!0,hz:311.127,name:"D\u266f4/E\u266d4"},{pos:44,key:"E",octave:4,idx:25,sharp:!1,hz:329.628,name:"E4"},{pos:45,key:"F",octave:4,idx:26,sharp:!1,hz:349.228,name:"F4"},{pos:46,key:"F",octave:4,idx:26,sharp:!0,hz:369.994,name:"F\u266f4/G\u266d4"},{pos:47,key:"G",octave:4,idx:27,sharp:!1,hz:391.995,name:"G4"},{pos:48,key:"G",octave:4,idx:27,sharp:!0,hz:415.305,name:"G\u266f4/A\u266d4"},{pos:49,key:"A",octave:4,idx:28,sharp:!1,hz:440,name:"A4 A440"},{pos:50,key:"A",octave:4,idx:28,sharp:!0,hz:466.164,name:"A\u266f4/B\u266d4"},{pos:51,key:"B",octave:4,idx:29,sharp:!1,hz:493.883,name:"B4"},{pos:52,key:"C",octave:5,idx:30,sharp:!1,hz:523.251,name:"C5 Tenor C"},{pos:53,key:"C",octave:5,idx:30,sharp:!0,hz:554.365,name:"C\u266f5/D\u266d5"},{pos:54,key:"D",octave:5,idx:31,sharp:!1,hz:587.33,name:"D5"},{pos:55,key:"D",octave:5,idx:31,sharp:!0,hz:622.254,name:"D\u266f5/E\u266d5"},{pos:56,key:"E",octave:5,idx:32,sharp:!1,hz:659.255,name:"E5"},{pos:57,key:"F",octave:5,idx:33,sharp:!1,hz:698.456,name:"F5"},{pos:58,key:"F",octave:5,idx:33,sharp:!0,hz:739.989,name:"F\u266f5/G\u266d5"},{pos:59,key:"G",octave:5,idx:34,sharp:!1,hz:783.991,name:"G5"},{pos:60,key:"G",octave:5,idx:34,sharp:!0,hz:830.609,name:"G\u266f5/A\u266d5"},{pos:61,key:"A",octave:5,idx:35,sharp:!1,hz:880,name:"A5"},{pos:62,key:"A",octave:5,idx:35,sharp:!0,hz:932.328,name:"A\u266f5/B\u266d5"},{pos:63,key:"B",octave:5,idx:36,sharp:!1,hz:987.767,name:"B5"},{pos:64,key:"C",octave:6,idx:37,sharp:!1,hz:1046.5,name:"C6 Soprano C(High C)"},{pos:65,key:"C",octave:6,idx:37,sharp:!0,hz:1108.73,name:"C\u266f6/D\u266d6"},{pos:66,key:"D",octave:6,idx:38,sharp:!1,hz:1174.66,name:"D6"},{pos:67,key:"D",octave:6,idx:38,sharp:!0,hz:1244.51,name:"D\u266f6/E\u266d6"},{pos:68,key:"E",octave:6,idx:39,sharp:!1,hz:1318.51,name:"E6"},{pos:69,key:"F",octave:6,idx:40,sharp:!1,hz:1396.91,name:"F6"},{pos:70,key:"F",octave:6,idx:40,sharp:!0,hz:1479.98,name:"F\u266f6/G\u266d6"},{pos:71,key:"G",octave:6,idx:41,sharp:!1,hz:1567.98,name:"G6"},{pos:72,key:"G",octave:6,idx:41,sharp:!0,hz:1661.22,name:"G\u266f6/A\u266d6"},{pos:73,key:"A",octave:6,idx:42,sharp:!1,hz:1760,name:"A6"},{pos:74,key:"A",octave:6,idx:42,sharp:!0,hz:1864.66,name:"A\u266f6/B\u266d6"},{pos:75,key:"B",octave:6,idx:43,sharp:!1,hz:1975.53,name:"B6"},{pos:76,key:"C",octave:7,idx:44,sharp:!1,hz:2093,name:"C7 Double high C"},{pos:77,key:"C",octave:7,idx:44,sharp:!0,hz:2217.46,name:"C\u266f7/D\u266d7"},{pos:78,key:"D",octave:7,idx:45,sharp:!1,hz:2349.32,name:"D7"},{pos:79,key:"D",octave:7,idx:45,sharp:!0,hz:2489.02,name:"D\u266f7/E\u266d7"},{pos:80,key:"E",octave:7,idx:46,sharp:!1,hz:2637.02,name:"E7"},{pos:81,key:"F",octave:7,idx:47,sharp:!1,hz:2793.83,name:"F7"},{pos:82,key:"F",octave:7,idx:47,sharp:!0,hz:2959.96,name:"F\u266f7/G\u266d7"},{pos:83,key:"G",octave:7,idx:48,sharp:!1,hz:3135.96,name:"G7"},{pos:84,key:"G",octave:7,idx:48,sharp:!0,hz:3322.44,name:"G\u266f7/A\u266d7"},{pos:85,key:"A",octave:7,idx:49,sharp:!1,hz:3520,name:"A7"},{pos:86,key:"A",octave:7,idx:49,sharp:!0,hz:3729.31,name:"A\u266f7/B\u266d7"},{pos:87,key:"B",octave:7,idx:50,sharp:!1,hz:3951.07,name:"B7"},{pos:88,key:"C",octave:8,idx:51,sharp:!1,hz:4186.01,name:"C8 Eighth octave"}];f.forEach((function(e){return e.hz=27.5*Math.pow(Math.pow(2,1/12),e.pos-1)}));var v=t(6),p=t.n(v),m="ebony",x="ivory",y="LEFT",b="MIDDLE",g="RIGHT";var j=function(e){var n=30,t=[],a=[],r=[],o=e.notes||[];return f.forEach((function(i){var c,u=function(e){var n,t,a=e%12;return 2===a||7===a?(n=g,t=m):5===a||10===a?(n=y,t=m):0===a?(n=b,t=m):(n=null,t=x),{shift:n,color:t}}(i.pos),l=n,h=125,d=22;u.color===m?(h-=45,d=11,u.shift===y?l=n-7:u.shift===b?l=n-5:u.shift===g?l=n-3:console.warn("SHIFT was not set")):(n+=22,r.push(Object(s.jsx)("text",{x:l+d/2,y:10,textAnchor:"middle",children:i.pos},i.pos+"number")),r.push(Object(s.jsx)("text",{style:{pointerEvents:"none"},x:l+d/2,y:120,textAnchor:"middle",children:i.key},i.pos+"key")));var f=!!o.find((function(e){return e.pos===i.pos})),v=Object(s.jsx)("rect",{rx:2,x:l,y:14,width:d,height:h,onClick:function(){var n;return null===(n=e.onClick)||void 0===n?void 0:n.call(e,i.pos-1)},style:null===(c=e.keyStyles)||void 0===c?void 0:c[i.pos],className:[p.a.key,u.color===m?p.a.ebony:p.a.ivory,f?p.a.lit:""].filter(Boolean).join(" ")},i.pos);u.color===m?a.push(v):t.push(v)})),Object(s.jsxs)("svg",{"data-ref":"piano",width:"1200",height:"200",children:[t,r,a]})},k={local:{sampleRate:44100,fftSize:32768,minDecibels:-90,maxDecibels:-10}},O="local";var z=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O;return k[n][e]},C=t(12),P=t(13),A=function(){function e(n){var t=this;Object(C.a)(this,e),this.audioContext=void 0,this.analyser=void 0,this.sampleRate=void 0,this.fftSize=void 0,this.freqDataArray=void 0,this.timeDataArray=void 0,this.stepSize=void 0,this.creatContextAndAnalyser(n),navigator.getUserMedia({audio:!0},(function(e){t.audioContext.createMediaStreamSource(e).connect(t.analyser)}),(function(e){e&&console.error(e)}))}return Object(P.a)(e,[{key:"creatContextAndAnalyser",value:function(e){this.audioContext=new AudioContext,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=(null===e||void 0===e?void 0:e.fftSize)||32768,this.analyser.minDecibels=(null===e||void 0===e?void 0:e.minDecibels)||-90,this.analyser.maxDecibels=(null===e||void 0===e?void 0:e.maxDecibels)||-10,this.sampleRate=this.audioContext.sampleRate,this.fftSize=this.analyser.fftSize,this.stepSize=this.sampleRate/this.fftSize;var n=this.fftSize/2;this.freqDataArray=new Uint8Array(n),this.timeDataArray=new Uint8Array(n)}},{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.freqDataArray),this.freqDataArray}},{key:"getTimeData",value:function(){return this.analyser.getByteTimeDomainData(this.timeDataArray),this.timeDataArray}}]),e}(),F=Math.pow(2,1/12),D=(F-1)/2+1,E=.75*(F-1)+1,w=(F-1)/100+1,M=function(e){var n=null;return e.forEach((function(e){(null===n||e>n)&&(n=e)})),n},S=function(e,n){if(!e.length)return{score:0,error:1/0,peaksUnused:0,harmonicsMissing:0,harmonics:[]};for(var t=[],a=0,r=[D,E,F],o=new Set(e.map((function(e){return e.center}))),i=0,c=0,u=0,l=M(e.map((function(e){return e.amplitude})))||0,s=function(s){var h=r[s],d=n,f=0,v=0,p=e[e.length-1].center,m=0,x=0,y=0;c=0,u=0;for(var b=.5*l;v*h<p&&x++<50&&(f=v,v+=d,!(y>=5));){var g=e.filter((function(e){return e.center>=v/h&&e.center<=v*h}));g.length?function(){y=0;var e=g[0];g.forEach((function(n){o.delete(n.center),n.amplitude>e.amplitude&&(e=n)})),t.push(e),m+=e.amplitude,b+=e.amplitude,d=Math.max(e.center-f,d)}():(y++,t.push(null),c++,u+=.8*b)}for(;null===t[t.length-1];)t.pop(),c--;c/=t.length,u/=t.length,a=m,e.forEach((function(e){o.has(e.center)&&(u+=e.amplitude)}));var j=0,k=0;if(e.forEach((function(e){o.has(e.center)&&(j+=e.amplitude),k+=e.amplitude})),i=j/k,h===E&&(u+=5e3),h===F&&(u+=1e4),a)return"break"},h=0;h<r.length;h++){if("break"===s(h))break}return{score:a,error:u,peaksUnused:i,harmonicsMissing:c,harmonics:t}},T=function(e){if((e=Object(c.a)(e||[])).filter(Boolean).length/e.length<.3)return e;var n=function n(t){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=(null===(a=e[t])||void 0===a?void 0:a.center)||null;if(o)return o;if(3===r)return null;var i=5;if(e[t-1])if(e[t+1]){var c=n(t+1,r+1),u=n(t-1,r+1);o=null===c||null===u?null:(c+u)/2}else{var l=n(t-1,r+1),s=n(t-1-i,r+1);if(null===l||null===s)o=null;else{var h=(l-s)/i;o=l+h}}else{var d=n(t+1,r+1),f=n(t+1+i,r+1);if(null===d||null===f)o=null;else{var v=(f-d)/i;o=d-v}}return null!==o&&(e[t]={center:o,amplitude:0}),o};return e.forEach((function(e,t){return n(t)})),e};function G(e,n){for(var t=[],a=1;a<e.length-1;a++){var r="number"===typeof n?n:n[a],o=e[a-1],i=e[a],c=e[a+1];if(i>r&&i>=o&&i>=c){var u=a+.5*(o-c)/(o-2*i+c),l=i-.25*(u-a)*(o-c);t.push({center:u,amplitude:l})}}return t}var N=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:55e-5,a=e*(n+1)*Math.sqrt(1+t*n*n);return a},q=function(e,n){for(var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:55e-5,a=[],r=0;r<=n;r++)a.push({amplitude:255-10*r,center:N(e,r,t)});return a},B=function(e,n){var t,a=null,r=0,o=D;if(e.forEach((function(e){var i=Math.abs(n-e.center);(null===a||i<a/o||i<a*o&&r<=e.amplitude)&&(a=i,r=e.amplitude,t=e)})),!t)throw new Error;return t},R=function(e,n){var t=255,a=[];n.forEach((function(n){var r=0;n.forEach((function(a,o){var i=B(e,a.center),c=Math.abs(i.center-a.center)/a.center,u=-.5;c<D&&(u=Math.min(i.amplitude/t/c,100)),r+=u/n.length})),a.push(r)}));var r=[];e.forEach((function(a,o){n.forEach((function(n,o){var i=B(n,a.center);r[o]=r[o]||0;var c=Math.abs(i.center-a.center)/i.center,u=a.amplitude/t*-.5;c<D&&(u=Math.min(a.amplitude/t/c,100)),r[o]+=u/e.length}))}));for(var o=[],i=0,c=0;c<a.length;c++)o[c]=a[c]+.33*r[c],o[c]>i&&(i=o[c]);for(var u=0;u<o.length;u++)o[u]=o[u]/i;return o},I=function(e){var n=e.lowFq,t=e.highFq,a=e.stepSize,r=e.peaks,o=e.targetHarmonics;try{for(var i=[],c=function(e){var n,t=e/((null===(n=o(e)[0])||void 0===n?void 0:n.center)||e);i.push(o(e).map((function(e){return Object(u.a)(Object(u.a)({},e),{},{center:((null===e||void 0===e?void 0:e.center)||0)*t})})))},l=n;l<t;l+=a)c(l);var s=R(r,i),h=G(s,.2),d=h.length?h.reduce((function(e,n){return e.amplitude>n.amplitude?e:n})):null;return{prediction:s,maxPeak:d,peakCenterFq:n+((null===d||void 0===d?void 0:d.center)||0)*a}}catch(f){return{prediction:[],maxPeak:null,peakCenterFq:0}}};var J=[],L=function(e){var n=(e&&e.target).tagName.toLocaleLowerCase();["input","textfield","textarea"].indexOf(n)>-1||({metaKey:e.metaKey,altKey:e.altKey,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey},J.forEach((function(n){return n(e)})))};document.addEventListener("keydown",L,!1),document.addEventListener("keyup",L,!1),document.addEventListener("keypress",L,!1);var H=function(e,n,t){Object(a.useEffect)((function(){var a=function(e,n,t){if(!e.length)return n;var a=t.pressType||["keydown"],r=new Set(("string"===typeof e?[e]:e).map((function(e){var n=e.toLowerCase().replace("++","+plus").replace("+ +","+plus").replace(/^\+/,"plus").split("+").map((function(e){return e.trim()})).map((function(e){return"plus"===e?"+":""===e?" ":e})),t=!1,a=!1,r=!1,o=!1,i=n[n.length-1];return n.forEach((function(e){"meta"===e||"command"===e||"cmd"===e?t=!0:"option"===e||"alt"===e?a=!0:"shift"===e?r=!0:"control"===e||"ctrl"===e?o=!0:i=e})),"".concat(t,"+").concat(a,"+").concat(r,"+").concat(o,"+").concat(i)})));return function(t){var o="".concat(t.metaKey,"+").concat(t.altKey,"+").concat(t.shiftKey,"+").concat(t.ctrlKey,"+").concat(t.key).toLowerCase();e.length&&!r.has(o)||-1!==a.indexOf(t.type)&&n(t)}}(e,n,{pressType:null===t||void 0===t?void 0:t.pressType});return J.push(a),function(){J=J.filter((function(e){return e!==a}))}}),[e,n,null===t||void 0===t?void 0:t.pressType])},K=t(8);function _(e){return void 0===e?e:JSON.parse(JSON.stringify(e))}var U=function(e){return Math.floor(Math.random()*e)},W=function(e){for(var n=[],t=[],a=function(e){for(var n=1,t=1,a=0;;){if(a++>1e3)throw new Error("not a fraction");if(n/t<e&&(n++,t=1),n/t>e&&t++,n/t===e)break}return[n,t]}(e),r=Object(l.a)(a,2),o=r[0],i=r[1],c=0,u=0,s=0;s<20;s++)c+=o,u+=i,n.push(c-1),t.push(u-1);return[n,t]},V={4:1.25,7:1.5,12:2,24:4},X=function(e,n){if(!e||!n)return null;var t=[];if(n.key<e.key){var a=e;e=n,n=a}var r=e.harmonics[0];e.harmonics.length<=2&&!e.harmonics[1]&&r&&((e=Object(u.a)(Object(u.a)({},e),{},{harmonics:Object(c.a)(e.harmonics)})).harmonics[1]={amplitude:r.amplitude,center:2.01*r.center});var o=V[n.key-e.key];if(!o)return null;for(var i=W(o),s=Object(l.a)(i,2),h=s[0],d=s[1],f=0;f<h.length;f++){var v,p,m,x;if(h[f]>=e.harmonics.length)break;if(d[f]>=n.harmonics.length)break;var y=(null===(v=e.harmonics[h[f]])||void 0===v?void 0:v.amplitude)||0,b=(null===(p=n.harmonics[d[f]])||void 0===p?void 0:p.amplitude)||0;if(y<20)break;if(b<20)break;var g=(null===(m=e.harmonics[h[f]])||void 0===m?void 0:m.center)||0,j=(null===(x=n.harmonics[d[f]])||void 0===x?void 0:x.center)||0,k=Math.abs((g-j)/g)*(y/255)*(b/255);t.push(k)}return t.length?t.reduce((function(e,n){return e+n}))/t.length/(w-1):null},Y=function(e,n){return Object(u.a)(Object(u.a)({},e),{},{fundamentalFq:e.fundamentalFq*n,fundamentalFqTWM:e.fundamentalFqTWM*n,fundamentalFqAutocorr:e.fundamentalFqAutocorr*n,harmonics:e.harmonics.map((function(e){return e?Object(u.a)(Object(u.a)({},e),{},{center:e.center*n}):e}))})},Q=function(e,n){var t=w,a=n(e),r=e;if(!a)return e;for(var o=!1,i=0;Math.abs(1-t)>1e-4&&i++<100;){var c=Y(r,t),u=n(c)||0;u<a?(r=c,a=u):o?(o=!1,t/=2):(o=!0,t=1/t)}return r},Z=function(e,n){for(var t=function(n){e[n]=Q(e[n],(function(t){return X(e[n-12],t)}))},a=n+12;a<=87;a+=12)t(a);for(var r=function(n){e[n]=Q(e[n],(function(t){return X(e[n+12],t)}))},o=n-12;o>=0;o-=12)r(o)},$=function(e){for(var n=0,t=0,a=0;a<88;a++)for(var r=a+1;r<88;r++){var o=X(e[a],e[r]);null!==o&&(n+=o,t++)}return n/t};function ee(e){var n="0123456789abcdef";return 0===e||isNaN(e)?"00":(e=Math.round(Math.min(Math.max(0,e),255)),n.charAt((e-e%16)/16)+n.charAt(e%16))}function ne(e){return"#"===e.charAt(0)?e.substring(1,7):e}function te(e){return[parseInt(ne(e).substring(0,2),16),parseInt(ne(e).substring(2,4),16),parseInt(ne(e).substring(4,6),16)]}var ae=["Piano.ff.01.A0.mp3","Piano.ff.02.Bb0.mp3","Piano.ff.03.B0.mp3","Piano.ff.04.C1.mp3","Piano.ff.05.Db1.mp3","Piano.ff.06.D1.mp3","Piano.ff.07.Eb1.mp3","Piano.ff.08.E1.mp3","Piano.ff.09.F1.mp3","Piano.ff.10.Gb1.mp3","Piano.ff.11.G1.mp3","Piano.ff.12.Ab1.mp3","Piano.ff.13.A1.mp3","Piano.ff.14.Bb1.mp3","Piano.ff.15.B1.mp3","Piano.ff.16.C2.mp3","Piano.ff.17.Db2.mp3","Piano.ff.18.D2.mp3","Piano.ff.19.Eb2.mp3","Piano.ff.20.E2.mp3","Piano.ff.21.F2.mp3","Piano.ff.22.Gb2.mp3","Piano.ff.23.G2.mp3","Piano.ff.24.Ab2.mp3","Piano.ff.25.A2.mp3","Piano.ff.26.Bb2.mp3","Piano.ff.27.B2.mp3","Piano.ff.28.C3.mp3","Piano.ff.29.Db3.mp3","Piano.ff.30.D3.mp3","Piano.ff.31.Eb3.mp3","Piano.ff.32.E3.mp3","Piano.ff.33.F3.mp3","Piano.ff.34.Gb3.mp3","Piano.ff.35.G3.mp3","Piano.ff.36.Ab3.mp3","Piano.ff.37.A3.mp3","Piano.ff.38.Bb3.mp3","Piano.ff.39.B3.mp3","Piano.ff.40.C4.mp3","Piano.ff.41.Db4.mp3","Piano.ff.42.D4.mp3","Piano.ff.43.Eb4.mp3","Piano.ff.44.E4.mp3","Piano.ff.45.F4.mp3","Piano.ff.46.Gb4.mp3","Piano.ff.47.G4.mp3","Piano.ff.48.Ab4.mp3","Piano.ff.49.A4.mp3","Piano.ff.50.Bb4.mp3","Piano.ff.51.B4.mp3","Piano.ff.52.C5.mp3","Piano.ff.53.Db5.mp3","Piano.ff.54.D5.mp3","Piano.ff.55.Eb5.mp3","Piano.ff.56.E5.mp3","Piano.ff.57.F5.mp3","Piano.ff.58.Gb5.mp3","Piano.ff.59.G5.mp3","Piano.ff.60.Ab5.mp3","Piano.ff.61.A5.mp3","Piano.ff.62.Bb5.mp3","Piano.ff.63.B5.mp3","Piano.ff.64.C6.mp3","Piano.ff.65.Db6.mp3","Piano.ff.66.D6.mp3","Piano.ff.67.Eb6.mp3","Piano.ff.68.E6.mp3","Piano.ff.69.F6.mp3","Piano.ff.70.Gb6.mp3","Piano.ff.71.G6.mp3","Piano.ff.72.Ab6.mp3","Piano.ff.73.A6.mp3","Piano.ff.74.Bb6.mp3","Piano.ff.75.B6.mp3","Piano.ff.76.C7.mp3","Piano.ff.77.Db7.mp3","Piano.ff.78.D7.mp3","Piano.ff.79.Eb7.mp3","Piano.ff.80.E7.mp3","Piano.ff.81.F7.mp3","Piano.ff.82.Gb7.mp3","Piano.ff.83.G7.mp3","Piano.ff.84.Ab7.mp3","Piano.ff.85.A7.mp3","Piano.ff.86.Bb7.mp3","Piano.ff.87.B7.mp3","Piano.ff.88.C8.mp3"],re=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,t=new AudioContext;e.forEach((function(e){if(e){var a=t.createOscillator();a.frequency.value=e.center;var r=t.createGain(),o=e.amplitude/255,i=1e-5,c=.01*o;r.gain.value=i,r.gain.exponentialRampToValueAtTime(o,t.currentTime+.01),r.gain.exponentialRampToValueAtTime(c,t.currentTime+1),r.gain.exponentialRampToValueAtTime(i,t.currentTime+n),a.connect(r),a.type="triangle",r.connect(t.destination),a.start(0),a.stop(n)}})),setTimeout((function(){return t.close()}),333*n)},oe={},ie=function(e,n){oe[n]=oe[n]||document.createElement("audio"),oe[n].src="/piano-tuning/mp3/"+ae[e],oe[n].play()},ce=t(10),ue=t.n(ce),le=t(14),se=function(){var e=Object(a.useState)(!document.hidden),n=Object(l.a)(e,2),t=n[0],r=n[1];return Object(a.useEffect)((function(){var e=function(){t===document.hidden&&r(!document.hidden)};return window.addEventListener("visibilitychange",e),function(){return window.removeEventListener("visibilitychange",e)}}),[t]),t},he={},de="undefined"!==typeof localStorage,fe="PIANO-TUNING-DATA-STORE",ve=12096e5,pe=0;function me(){if(de){var e=localStorage.getItem(fe);if(e)return JSON.parse(e)}return he}function xe(e){he=e,de&&localStorage.setItem(fe,JSON.stringify(e))}function ye(e){var n=me();delete n[e],xe(n)}var be={set:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ve,a=me();return a[e]={expiration:Date.now()+t,value:n},xe(a),n},get:function(e){var n=me()[e];if(n)return n.expiration<Date.now()?ye(e):n.value},clear:ye,checkForExpired:function(){if(!(Date.now()<pe+36e5)){var e=me();Object.keys(e).forEach((function(n){e[n].expiration<Date.now()&&delete e[n]})),xe(e),pe=Date.now()}}},ge=function(e,n){for(var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,r=[],o=Math.floor(n/a)-1,i=Math.ceil(n/t)+1,c=e.length-i,u=0,l=1,s=-1,h=o;h<i;h++){var d=0;c=e.length-h;for(var f=0;f<c;f++){var v=(e[f]-128)/128,p=(e[f+h]-128)/128;d+=v*p}var m=d/c;r.push(m),m<l&&(l=m),m>u&&(u=m,s=h)}return r.map((function(e,t){return{r:(e-l)/(u-l),k:t/s,fq:n/(t+o)}}))},je=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,r=ge(e,n,t,a),o=G(r.map((function(e){return e.r})),.9),i=o.map((function(e){var n,t,a=Math.floor(e.center),o=e.center-a,i=null===(n=r[a])||void 0===n?void 0:n.fq,c=(null===(t=r[a+1])||void 0===t?void 0:t.fq)||i;return{amplitude:e.amplitude,center:i*(1-o)+c*o}})),c=0,u=0;return i.forEach((function(e){e.amplitude>1.05*u&&(u=e.amplitude,c=e.center)})),{autocorrelation:r,autoPeaksFq:i,largestPeakFq:c}};function ke(e,n){var t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download",n),document.body.appendChild(a),a.click(),a.remove()}function Oe(e){return{type:"file",onChange:function(n){var t=n.target.files;if(null===t||void 0===t?void 0:t.length){var a=t[0],r=new FileReader;r.onload=function(n){var t,a=null===(t=n.target)||void 0===t?void 0:t.result;e(JSON.parse(a))},r.readAsText(a)}}}}var ze=be.get("recordedHarmonics")||{},Ce=be.get("tunedHarmonics")||{},Pe=function(e,n,t){for(var a,r=te(e),o=te(n),i=t,c=0,u=[],l=0;l<i;l++){var s=[0,0,0];c+=1/i,s[0]=o[0]*c+(1-c)*r[0],s[1]=o[1]*c+(1-c)*r[1],s[2]=o[2]*c+(1-c)*r[2],u.push(ee((a=s)[0])+ee(a[1])+ee(a[2]))}return u}("00FF00","FF0000",100),Ae={mode:"recording",noteSounds:{harmonics:"tuned",notes:[0]},tuning:{curve:"entropy"},transition:{auto:"next"},hiddenCharts:[]};var Fe=function(){var e=Object(a.useRef)(),n=Object(a.useRef)({autoChange:0,volume:[],lastReset:0}),t=Object(a.useRef)(be.get("tuningSettings")||Ae),r=Object(a.useRef)(0),o=Object(a.useState)(0),i=Object(l.a)(o,2),v=i[0],p=i[1],m=function(n){var a=t.current.noteSounds.harmonics;if(!e.current)if("piano"===a){var o=t.current.noteSounds.notes||[];-1!==o.indexOf(0)&&ie(n,0),-1!==o.indexOf(4)&&n+4<88&&ie(n+4,4),-1!==o.indexOf(7)&&n+7<88&&ie(n+7,7),-1!==o.indexOf(12)&&n+12<88&&ie(n+12,12),-1!==o.indexOf(24)&&n+24<88&&ie(n+24,24)}else{var i,c,l,s,h,d,v,m,x,y,b="recorded"===a?ze:"tuned"===a?Ce:{};b=Object(u.a)({},b)||{},[0,4,7,12,24].forEach((function(e){var t=n+e;!b[t]&&f[t]&&(b[t]={harmonics:q(f[t].hz,Math.ceil(88-t)/10)})}));var g=t.current.noteSounds.notes||[];-1!==g.indexOf(0)&&re(null===(i=b)||void 0===i||null===(c=i[n])||void 0===c?void 0:c.harmonics),-1!==g.indexOf(4)&&n+4<88&&re(null===(l=b)||void 0===l||null===(s=l[n+4])||void 0===s?void 0:s.harmonics),-1!==g.indexOf(7)&&n+7<88&&re(null===(h=b)||void 0===h||null===(d=h[n+7])||void 0===d?void 0:d.harmonics),-1!==g.indexOf(12)&&n+12<88&&re(null===(v=b)||void 0===v||null===(m=v[n+12])||void 0===m?void 0:m.harmonics),-1!==g.indexOf(24)&&n+24<88&&re(null===(x=b)||void 0===x||null===(y=x[n+24])||void 0===y?void 0:y.harmonics)}p(n),r.current=n};H("ArrowLeft",(function(){v>0&&m(v-1)})),H("ArrowRight",(function(){v<87&&m(v+1)})),function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,t=se();Object(a.useEffect)((function(){if(t){var a=0,r=!0,o=function(){var t=Object(le.a)(ue.a.mark((function t(){return ue.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(clearTimeout(a),r){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e();case 5:a=window.setTimeout(o,n);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return a=window.setTimeout(o,0),function(){r=!1,clearTimeout(a)}}}),[t,e,n])}((function(){JSON.stringify(be.get("recordedHarmonics"))!==JSON.stringify(ze)&&be.set("recordedHarmonics",ze),JSON.stringify(be.get("tunedHarmonics"))!==JSON.stringify(Ce)&&be.set("tunedHarmonics",Ce),JSON.stringify(be.get("tuningSettings"))!==JSON.stringify(t.current)&&be.set("tuningSettings",t.current)}),6e4);var x=Object(a.useState)(0),y=Object(l.a)(x,2)[1],b=function(){return y((function(e){return e+1}))},g={};!function(){var e="recorded"===t.current.noteSounds.harmonics?ze:Ce,n=t.current.noteSounds.notes,a={},r=e[v];if(r)for(var o=0;o<88;o++){var i;if(-1!==n.indexOf(Math.abs(((null===e||void 0===e||null===(i=e[o])||void 0===i?void 0:i.key)||0)-r.key))){var c=X(r,e[o]);if(null!==c){a[o]=c;var u=Math.floor(Math.min(99,10*c));g[o+1]={fill:"#".concat(Pe[u])}}}}}();var k,O=Math.min(window.innerWidth-2,1024),C=Math.max(O/1024*300,150),P=h({domain:{x1:0,x2:4500,y1:255,y2:0},width:O,height:C}),D=h({domain:{x1:1/F,x2:F,y1:255,y2:0},width:O,height:C}),E=h({domain:{x1:-2,x2:104,y1:1,y2:0},width:O,height:C}),N=h({domain:{x1:0,x2:4500,y1:1,y2:0},width:O,height:C}),B=h({domain:{x1:-1,x2:50,y1:2,y2:.8},width:O,height:C}),R=h({domain:{x1:-1,x2:88,y1:1*F,y2:1/F},width:O,height:C}),J=function(e){var n,a;return-1===(null!==(n=null===(a=t.current.hiddenCharts)||void 0===a?void 0:a.indexOf(e))&&void 0!==n?n:-1)},L=function(e){var n=t.current.hiddenCharts.indexOf(e);-1===n?t.current.hiddenCharts.push(e):t.current.hiddenCharts.splice(n,1),b()};return k=function(){var a=f[r.current];P.clear(),D.clear(),E.clear(),B.clear(),R.clear(),N.clear(),function(){var e,n,t,o,i,c,u,l,s,h=(null===(e=Ce[r.current])||void 0===e?void 0:e.fundamentalFq)||0,d=(null===(n=ze[r.current])||void 0===n?void 0:n.fundamentalFq)||0;B.line({x1:0,x2:49,y1:1,y2:1}),B.line({x1:0,x2:49,y1:(h||d)/a.hz,y2:(h||d)/a.hz},"red"),B.text({x:0,y:1.9},"".concat(a.name," (").concat(Math.round(100*a.hz)/100,")")),d&&B.text({x:0,y:1.8},"Recorded (".concat(Math.round(100*d)/100,")")),h&&B.text({x:0,y:1.7},"Tuned (".concat(Math.round(100*h)/100,")"),"red"),null===(t=(null===(o=Ce[r.current])||void 0===o?void 0:o.harmonics)||(null===(i=ze[r.current])||void 0===i?void 0:i.harmonics))||void 0===t||t.forEach((function(e,n){e&&P.line({x1:e.center,x2:e.center,y1:0,y2:e.amplitude},"green")})),null===(c=ze[r.current])||void 0===c||null===(u=c.harmonics)||void 0===u||u.forEach((function(e,n){e&&B.circle({x:n,y:e.center/a.hz/(n+1)},5,"rgb(0 0 0 / ".concat(Math.round(Math.min(100,(e.amplitude+30)/2.55)),"%)"))})),null===(l=Ce[r.current])||void 0===l||null===(s=l.harmonics)||void 0===s||s.forEach((function(e,n){if(e){var t=e.center/a.hz/(n+1);B.line({x1:n-.5,x2:n+.5,y1:t,y2:t},"red")}}))}(),f.forEach((function(e,n){var t,a,o,i,c,u,l,s,h,d,f=null===(t=ze[n])||void 0===t?void 0:t.harmonics,v=null===(a=Ce[n])||void 0===a?void 0:a.harmonics;(null===(o=ze)||void 0===o?void 0:o[n])&&(ze[n].harmonics=T(f));var p=(null===(i=ze)||void 0===i||null===(c=i[n])||void 0===c?void 0:c.fundamentalFq)||(null===f||void 0===f||null===(u=f[0])||void 0===u?void 0:u.center);p&&R.circle({x:n,y:p/e.hz}),(null===(l=Ce)||void 0===l?void 0:l[n])&&(Ce[n].harmonics=T(v)),(p=(null===(s=Ce)||void 0===s||null===(h=s[n])||void 0===h?void 0:h.fundamentalFq)||(null===v||void 0===v||null===(d=v[0])||void 0===d?void 0:d.center))&&R.line({x1:n-.5,x2:n+.5,y1:p/e.hz,y2:p/e.hz},"red"),n===r.current&&R.line({x1:n,x2:n,y1:F,y2:1/F},"blue")})),R.line({x1:0,x2:87,y1:1,y2:1});var o=e.current;if(o){var i=o.getFrequencyData(),l=o.getTimeData(),s=o.sampleRate/o.fftSize,h=function(e){for(var n=60,t=new Uint8Array(e.length),a=[],r=[],o=[],i=-60;i<e.length+n;i++){var c=Math.max(0,i-n),u=Math.min(i+n,e.length-1),l=u-c+1,s=a[i-1+n]||0;i+n<e.length&&(s+=e[i+n]),i-n-1>=0&&(s-=e[i-n-1]);for(var h=s/l,d=0,f=c;f<=u;f++)d+=Math.pow(e[f]-h,2);if(a[i+n]=s,r[i+n]=d,o[i+n]=l,!(i<0||i>e.length)){var v=Math.pow(d/(l-1),.5);v=Math.min(10,v),t[i]=Math.min(2.5*v+h,255)}}return t}(i),d=G(i,h).map((function(e){return Object(u.a)(Object(u.a)({},e),{},{center:e.center*s})}));!function(){i.forEach((function(e,n){P.rect({x1:n*s,x2:(n+1)*s,y1:0,y2:e})})),h.forEach((function(e,n){0!==n&&P.line({x1:n*s,x2:(n+1)*s,y1:h[n-1],y2:e},"blue")})),d.forEach((function(e,n){P.circle({x:e.center,y:e.amplitude},5,"red"),P.text({x:4e3,y:245-10*(n+1)},"Peak: ".concat(Math.round(10*e.center)/10," (").concat(Math.round(e.amplitude),")"))}));for(var e=[],n=0;n<d.length;n++){var t;e.push(d[n].center-((null===(t=d[n-1])||void 0===t?void 0:t.center)||0))}var a=e[Math.floor(e.length/2)];P.text({x:4e3,y:245},"Med Dist: ".concat(Math.round(10*a)/10))}(),function(){var e,n,t,o,u,l=(null===(e=Ce[r.current])||void 0===e?void 0:e.harmonics)||(null===(n=ze[r.current])||void 0===n?void 0:n.harmonics),h=null===l||void 0===l||null===(t=l.find((function(e){return(null===e||void 0===e?void 0:e.amplitude)===Math.max.apply(Math,Object(c.a)(l.map((function(e){return(null===e||void 0===e?void 0:e.amplitude)||0}))))})))||void 0===t?void 0:t.center;if(h){var f=((null===(o=Ce)||void 0===o||null===(u=o[r.current])||void 0===u?void 0:u.fundamentalFq)||a.hz)/h;i.forEach((function(e,n){D.rect({x1:(n-.5)*s/h,x2:(n+.5)*s/h,y1:0,y2:e})})),D.line({x1:1,x2:1,y1:0,y2:255},"red"),d.forEach((function(e,n){D.line({x1:e.center/h,x2:e.center/h,y1:0,y2:255},"green")}));var v=d.length?d.reduce((function(e,n){return Math.abs(h-e.center)<Math.abs(h-n.center)?e:n})):null;D.text({x:1.001/F,y:240},"".concat(a.name," (").concat(Math.round(100*a.hz)/100,")")),D.text({x:1.001/F,y:220},"Focused: ".concat(Math.round(h*f*100)/100),"red"),D.text({x:1.001/F,y:200},"Peak: ".concat(Math.round(((null===v||void 0===v?void 0:v.center)||0)*f*100)/100),"green"),D.text({x:1.001/F,y:180},"Harmonic Shown: ".concat(Math.round(100*h)/100))}}(),window.timelinePeaksData=window.timelinePeaksData||[],window.timelinePeaksData.push({peaks:d,key:r.current}),function(){var e,n,t,i,c,u,s,h=(null===(e=Ce)||void 0===e||null===(n=e[r.current])||void 0===n?void 0:n.fundamentalFqAutocorr)||(null===(t=Ce)||void 0===t||null===(i=t[r.current])||void 0===i?void 0:i.fundamentalFq)||a.hz,d=(null===(c=Ce[r.current])||void 0===c?void 0:c.fundamentalFq)/((null===(u=Ce)||void 0===u||null===(s=u[r.current])||void 0===s?void 0:s.fundamentalFqAutocorr)||0)||1,f=h/F,v=h*F,p=je(l,o.sampleRate,f,v),m=p.autocorrelation,x=p.largestPeakFq;N.setDomain({x1:f,x2:v,y1:1,y2:0});for(var y=1;y<m.length;y++)N.rect({x1:m[y-1].fq,x2:m[y].fq,y1:0,y2:m[y-1].r});N.line({x1:h,x2:h,y1:0,y2:1},"red"),N.line({x1:x,x2:x,y1:0,y2:1},"green"),N.text({x:h/F,y:.9},"".concat(a.name," (").concat(Math.round(100*a.hz)/100,")")),N.text({x:h/F,y:.8},"Focused: ".concat(Math.round(h*d*100)/100),"red"),N.text({x:h/F,y:.7},"Peak: ".concat(Math.round(x*d*10)/10),"green")}(),function(){var e,a=function(e){var n=f[e].hz;return S(d,n)},c=function(e,n){var t,a=f[e].hz;if(n.score>((null===(t=ze[e])||void 0===t?void 0:t.score)||0)){var r,i=a*(w-1),c=a-50*i,s=a+50*i,h=d[d.length-1].center,v=I({lowFq:c,highFq:s,stepSize:i,targetHarmonics:function(e){return q(e,Math.round(h/e),55e-5)},peaks:d}).peakCenterFq,p=je(l,o.sampleRate,a/F,a*F).largestPeakFq,m=T(n.harmonics),x=v;(x<=1.1*c||x>=.9*s)&&(x=(null===(r=m[0])||void 0===r?void 0:r.center)||0),ze[e]=Object(u.a)(Object(u.a)({},n),{},{harmonics:m,fundamentalFq:x,fundamentalFqTWM:v,fundamentalFqAutocorr:p,key:e})}},s=a(r.current),h=M(i)||0;if("tuning"===t.current.mode&&function(e){var n=0;return e.forEach((function(e){return n+=e})),n/=e.length}(n.current.volume)<10&&h>50&&Date.now()-n.current.lastReset>2e3&&s.score>.5*((null===(e=ze[r.current])||void 0===e?void 0:e.score)||0)&&(delete ze[r.current],n.current.lastReset=Date.now()),n.current.volume.push(h),n.current.volume.length>10&&n.current.volume.shift(),c(r.current,s),"next"===t.current.transition.auto&&r.current<87){var v=a(r.current+1);v.score>s.score&&Date.now()-n.current.autoChange>2e3&&(n.current.autoChange=Date.now(),c(r.current+1,v),m(r.current+1))}}(),function(){if(d.length){var e,n,t,o,i,c,u,l=d[d.length-1].center,s=(null===(e=Ce[r.current])||void 0===e||null===(n=e.harmonics)||void 0===n||null===(t=n[0])||void 0===t?void 0:t.center)||a.hz,h=s*(w-1),f=(null===(o=Ce[r.current])||void 0===o?void 0:o.fundamentalFq)/((null===(i=Ce[r.current])||void 0===i||null===(c=i.harmonics)||void 0===c||null===(u=c[0])||void 0===u?void 0:u.center)||1)||1,v=I({lowFq:s-50*h,highFq:s+50*h,stepSize:h,targetHarmonics:function(e){var n;return(null===(n=Ce[r.current])||void 0===n?void 0:n.harmonics)||q(e,Math.round(l/e),55e-5)},peaks:d}),p=v.prediction,m=v.maxPeak,x=v.peakCenterFq;p.forEach((function(e,n){E.rect({x1:n-.5,x2:n+.5,y1:0,y2:e})})),E.line({x1:(null===m||void 0===m?void 0:m.center)||0,x2:(null===m||void 0===m?void 0:m.center)||0,y1:0,y2:1},"green"),E.line({x1:50,x2:50,y1:0,y2:1},"red"),E.text({x:0,y:.9},"".concat(a.name," (").concat(Math.round(100*a.hz)/100,")")),E.text({x:0,y:.8},"Focused: ".concat(Math.round(s*f*100)/100),"red"),E.text({x:0,y:.7},"Peak: ".concat(Math.round(x*f*100)/100),"green")}}()}},Object(a.useEffect)((function(){var e=!1;return function n(){e||(k(),requestAnimationFrame(n))}(),function(){e=!0}}),[k]),Object(s.jsxs)("div",{className:"App",children:[e.current?Object(s.jsx)("button",{style:{background:"#f44336",color:"#fff",margin:20,border:"1px solid #a92319"},onClick:function(){e.current=void 0,b()},children:"Stop Listening"}):Object(s.jsx)("button",{style:{background:"#37c53c",color:"#fff",margin:20,border:"1px solid green"},onClick:function(){e.current=new A({fftSize:z("fftSize"),minDecibels:z("minDecibels"),maxDecibels:z("maxDecibels")}),b()},children:"Start Listening"}),Object(s.jsx)("div",{style:{overflowX:"auto",overflowY:"hidden",height:150},children:Object(s.jsx)(j,{onClick:m,notes:[f[v]],keyStyles:g})}),Object(s.jsxs)("div",{children:["Mode",Object(s.jsxs)("select",{value:t.current.mode,onChange:function(e){t.current.mode=e.target.value,b()},children:[Object(s.jsx)("option",{value:"recording",children:"Recording"}),Object(s.jsx)("option",{value:"tuning",children:"Tuning"})]}),Object(s.jsxs)("select",{value:t.current.transition.auto,onChange:function(e){t.current.transition.auto=e.target.value,b()},children:[Object(s.jsx)("option",{value:"none",children:"Auto Transition Disabled"}),Object(s.jsx)("option",{value:"next",children:"Auto Transition To Next Note"})]})]}),Object(s.jsxs)("div",{children:["Recorded",Object(s.jsx)("button",{onClick:function(){return ke(ze,"recorded.json")},children:"Download"}),Object(s.jsx)("input",Object(u.a)({className:"fileInput"},Oe((function(e){return ze=e})))),Object(s.jsx)("button",{onClick:function(){return delete ze[v]},children:"Clear Current"}),Object(s.jsx)("button",{onClick:function(){return ze={}},children:"Clear All"})]}),Object(s.jsxs)("div",{children:["Tuned",Object(s.jsx)("button",{onClick:function(){return ke(Ce,"tuned.json")},children:"Download"}),Object(s.jsx)("input",Object(u.a)({className:"fileInput"},Oe((function(e){return Ce=e})))),Object(s.jsx)("button",{onClick:function(){return Ce={}},children:"Clear All"})]}),Object(s.jsxs)("div",{children:["Sounds",Object(s.jsxs)("select",{value:JSON.stringify(t.current.noteSounds.notes),onChange:function(e){t.current.noteSounds.notes=JSON.parse(e.target.value),b()},children:[Object(s.jsx)("option",{value:"[]",children:"No Sounds"}),Object(s.jsx)("option",{value:"[0]",children:"Note Only"}),Object(s.jsx)("option",{value:"[0,4]",children:"Note + Third"}),Object(s.jsx)("option",{value:"[0,7]",children:"Note + Fifth"}),Object(s.jsx)("option",{value:"[0,12]",children:"Note + Octave"}),Object(s.jsx)("option",{value:"[0,24]",children:"Note + Double Octave"}),Object(s.jsx)("option",{value:"[0,4,7]",children:"Note + Third + Fifth"}),Object(s.jsx)("option",{value:"[0,4,7,12]",children:"Note + Third + Fifth + Octave"}),Object(s.jsx)("option",{value:"[0,12,24]",children:"Note + Octave + Double Octave"}),Object(s.jsx)("option",{value:"[0,4,7,12,24]",children:"Note + All"})]}),Object(s.jsxs)("select",{value:t.current.noteSounds.harmonics,onChange:function(e){t.current.noteSounds.harmonics=e.target.value,b()},children:[Object(s.jsx)("option",{value:"recorded",children:"Recorded Notes"}),Object(s.jsx)("option",{value:"tuned",children:"Tuned Notes"}),Object(s.jsx)("option",{value:"generated",children:"Generated Notes"}),Object(s.jsx)("option",{value:"piano",children:"Sample Piano Sound"})]})]}),Object(s.jsxs)("div",{children:["Tuning",Object(s.jsxs)("select",{value:t.current.tuning.curve,onChange:function(e){t.current.tuning.curve=e.target.value,b()},children:[Object(s.jsx)("option",{value:"none",children:"No Curve"}),Object(s.jsx)("option",{value:"copy",children:"Same as Recorded"}),Object(s.jsx)("option",{value:"7,12",children:"Tune With Fifths + Octaves"}),Object(s.jsx)("option",{value:"entropy",children:"Tune With Entropy"})]}),Object(s.jsx)("button",{onClick:function(){var e=t.current.tuning.curve;"copy"===e&&(Ce=_(ze)),"none"===e&&(Ce=function(e){e=_(e);for(var n=0;n<88;n++){var t;e[n].harmonics=T(e[n].harmonics),e[n]=Y(e[n],f[n].hz/((null===(t=e[n].harmonics[0])||void 0===t?void 0:t.center)||f[n].hz))}return e}(ze)),"7,12"===e&&(Ce=function(e){var n,t=(e=_(e))[48];e[48]=Y(t,440/((null===(n=t.harmonics[0])||void 0===n?void 0:n.center)||440));var a=48;Z(e,a);for(var r=0;r<11;r++)a<30&&(a+=12),Q(e[a-7],(function(n){return X(e[a],n)})),Z(e,a+=-7);return e}(ze)),"entropy"===e&&(Ce=function(e){var n,t=(e=_(e))[48];e[48]=Y(t,440/((null===(n=t.harmonics[0])||void 0===n?void 0:n.center)||440));var a=$(e);console.log(a);for(var r=function(n){for(var t=48;48!==t;)t=U(88);for(var r=t+1;r!==t;)88===r&&(r=0),e[r]=Q(e[r],(function(n){return $(Object(u.a)(Object(u.a)({},e),{},Object(K.a)({},r,n)))})),r+=1;var o=$(e);if(!(o<a))return"break";a=o,console.log(n,a)},o=0;o<10&&"break"!==r(o);o++);return e}(ze))},children:"Generate Tuning Curve"})]}),Object(s.jsx)("br",{}),Object(s.jsx)("div",{className:"chartTitle",onClick:function(){return L("fullFFT")},children:"Full Spectrum FFT"}),Object(s.jsx)("div",{className:"chartContainer",style:{height:J("fullFFT")?C+2:0},children:Object(s.jsx)(d,Object(u.a)({},P))}),Object(s.jsx)("div",{className:"chartTitle",onClick:function(){return L("focusedFFT")},children:"Focused FFT"}),Object(s.jsx)("div",{className:"chartContainer",style:{height:J("focusedFFT")?C+2:0},children:Object(s.jsx)(d,Object(u.a)({},D))}),Object(s.jsx)("div",{className:"chartTitle",onClick:function(){return L("twm")},children:"Two Way Mismatch"}),Object(s.jsx)("div",{className:"chartContainer",style:{height:J("twm")?C+2:0},children:Object(s.jsx)(d,Object(u.a)({},E))}),Object(s.jsx)("div",{className:"chartTitle",onClick:function(){return L("autocorr")},children:"Autocorrelation"}),Object(s.jsx)("div",{className:"chartContainer",style:{height:J("autocorr")?C+2:0},children:Object(s.jsx)(d,Object(u.a)({},N))}),Object(s.jsx)("div",{className:"chartTitle",onClick:function(){return L("harmonics")},children:"Current Note Harmonics"}),Object(s.jsx)("div",{className:"chartContainer",style:{height:J("harmonics")?C+2:0},children:Object(s.jsx)(d,Object(u.a)({},B))}),Object(s.jsx)("div",{className:"chartTitle",onClick:function(){return L("curve")},children:"Tuning Curve"}),Object(s.jsx)("div",{className:"chartContainer",style:{height:J("curve")?C+2:0},children:Object(s.jsx)(d,Object(u.a)({},R))})]})},De=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,24)).then((function(n){var t=n.getCLS,a=n.getFID,r=n.getFCP,o=n.getLCP,i=n.getTTFB;t(e),a(e),r(e),o(e),i(e)}))};i.a.render(Object(s.jsx)(r.a.StrictMode,{children:Object(s.jsx)(Fe,{})}),document.getElementById("root")),De()},6:function(e,n,t){e.exports={key:"piano_key__38M4z",ivory:"piano_ivory__A0tOg",ebony:"piano_ebony__3WXM6",lit:"piano_lit__2Tqvo"}}},[[23,1,2]]]);
//# sourceMappingURL=main.4e993d4a.chunk.js.map